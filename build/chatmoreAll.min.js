function chatmoreState(){var h=this;var f=0;var b=31;var e=function(l,k){if(k===undefined){k=2166136261}for(var j=0;j<l.length;j++){k*=16777619;k^=l.charCodeAt(j);k&=4294967295}return k};var d=function(i){for(var j in i){if(i.hasOwnProperty(j)){return false}}return true};h.isModified=false;h.isActivated=false;h.isRegistered=false;h.registrationAttemptCount=0;h.nick=undefined;h.ident=undefined;h.realname=undefined;h.channels={};h.users={};h.lastRecvTime=undefined;h.messageCount=0;h.sessionId=undefined;h.getChannels=function(){var i=[];for(var j in h.channels){i.push(j)}return i};h.getUsers=function(){var j=[];for(var i in h.users){j.push(i)}return j};h.addChannel=function(i){if(h.channels[i]===undefined){h.channels[i]=new g();h.isModified=true}return h.channels[i]};h.addUser=function(i){if(h.users[i]===undefined){h.users[i]=new a();h.isModified=true}return h.users[i]};h.removeChannel=function(i){if(h.channels[i]!==undefined){delete h.channels[i];h.isModified=true}};h.removeUser=function(i){if(h.users[i]!==undefined){delete h.users[i];h.isModified=true}};h.clearChannels=function(){if(!d(h.channels)){h.channels={};h.isModified=true}};h.clearUsers=function(){if(!d(h.users)){h.users={};h.isModified=true}};function g(){this.mode=undefined;this.visibility=undefined;this.topic=undefined;this.topicSetByNick=undefined;this.topicSetTime=undefined;this.members={};this.lastRPL_NAMREPLY=0;this.lastRPL_ENDOFNAMES=0;this.addMember=function(i){if(this.members[i]===undefined){member=new c();member.mode="";nickHash=e(i);member.colorizeNumber=nickHash%(b-f+1)+f;this.members[i]=member;h.isModified=true}return this.members[i]};this.removeMember=function(i){if(this.members[i]!==undefined){delete this.members[i];h.isModified=true}};this.clearMembers=function(){if(!d(this.members)){this.members={};h.isModified=true}}}function c(){this.mode=undefined;this.colorizeNumber=undefined}function a(){this.realname=undefined;this.host=undefined;this.mode=undefined}};function chatmore(e,d,c,b,a,g,i){if(i===undefined){i={}}var h=this;var f;f={pollHandle:undefined,pollXhr:undefined,pauseRecv:false,processMessages:function(j){if(j===undefined){return false}h.state.lastRecvTime=new Date().getTime();$.each(j,function(k,m){$(e).trigger("processingMessage.chatmore",[m]);h.state.messageCount++;switch(m.type){case"recv":if(window.console){if(m.raw!==undefined){console.log(m.raw)}}switch(m.command){case"JOIN":if(h.state.channels[m.info.channel]===undefined){h.state.addChannel(m.info.channel);h.sendMsg("MODE "+m.info.channel)}h.state.channels[m.info.channel].addMember(m.prefixNick);break;case"PART":if(h.stricmp(m.prefixNick,h.state.nick)===0){h.state.removeChannel(m.info.channel)}else{h.state.channels[m.info.channel].removeMember(m.prefixNick)}break;case"KICK":$.each(m.info.kicks,function(n,o){if(h.stricmp(o.nick,h.state.nick)===0){h.state.removeChannel(o.channel)}else{h.state.channels[o.channel].removeMember(o.nick)}});break;case"MODE":if(h.isChannel(m.info.target)){if(h.state.channels[m.info.target]!==undefined){h.sendMsg("MODE "+m.info.target);h.sendMsg("NAMES "+m.info.target)}}else{h.state.addUser(m.info.target);h.state.users[m.info.target].mode=m.info.mode;h.state.isModified=true}break;case"NICK":if(h.stricmp(m.prefixNick,h.state.nick)===0){h.state.nick=m.info.nick}h.renameNick(m.info.oldNick,m.info.nick);break;case"QUIT":$.each(h.state.channels,function(n,o){o.removeMember(m.prefixNick)});h.state.removeUser(m.prefixNick);break;case"001":if(!h.state.isRegistered){h.state.isRegistered=true;h.state.isModified=true}break;case"324":if(h.state.channels[m.info.channel]!==undefined){h.state.channels[m.info.channel].mode=m.info.mode;h.state.isModified=true}break;case"331":if(h.state.channels[m.info.channel]!==undefined){h.state.channels[m.info.channel].topic=undefined;h.state.isModified=true}break;case"332":if(h.state.channels[m.info.channel]!==undefined){h.state.channels[m.info.channel].topic=(m.info.topic!=="")?m.info.topic:undefined;h.state.isModified=true}break;case"333":if(h.state.channels[m.info.channel]!==undefined){h.state.channels[m.info.channel].topicSetByNick=m.info.nick;h.state.channels[m.info.channel].topicSetTime=m.info.time;h.state.isModified=true}break;case"403":h.state.removeChannel(m.info.channel);break;case"353":var l=h.state.addChannel(m.info.channel);l.visibility=m.info.visibility;if(l.lastRPL_NAMREPLY<l.lastRPL_ENDOFNAMES){l.clearMembers()}$.each(m.info.names,function(o,n){h.state.addUser(n.nick);memberDesc=l.addMember(n.nick);memberDesc.mode=n.mode});l.lastRPL_NAMREPLY=h.state.messageCount;h.state.isModified=true;break;case"366":if(h.state.channels[m.info.channel]!==undefined){h.state.channels[m.info.channel].lastRPL_ENDOFNAMES=h.state.messageCount}break;case"433":if(!h.state.isRegistered){if(h.state.registrationAttemptCount<h.options.maxRegistrationAttempts){if(h.state.baseNick===undefined){h.state.baseNick=h.state.nick}h.state.nick=""+h.state.baseNick+"_"+h.state.registrationAttemptCount;h.state.registrationAttemptCount++;h.state.isModified=true;$(e).trigger("localMessage.chatmore",[null,"clientMsg",{code:"R1"}]);h.sendMsg("NICK "+h.state.nick)}else{$(e).trigger("localMessage.chatmore",[null,"error",{code:"RE1",maxRegistrationAttempts:h.options.maxRegistrationAttempts}])}}break}break;case"servermsg":if(window.console){if(m.message!==undefined){console.log("servermsg: "+m.code+" "+m.message)}else{console.log("servermsg: "+m.code)}}if(m.code>=400){if(h.state.isActivated&&m.code===400){h.deactivateClient()}}break}$(e).trigger("processedMessage.chatmore",[m]);if(h.state.isModified){$(e).trigger("stateChanged.chatmore");h.state.isModified=false}})}};h.options=$.extend({maxRegistrationAttempts:3,maxResendAttempts:4},i);h.state=new chatmoreState();h.state.server=c;h.state.port=b;h.state.nick=a;h.state.realname=g;h.state.isModified=true;h.target=function(j){if(j===undefined){return f.target}else{if(j===null){j=undefined}f.target=j}};h.activateClient=function(){h.state.isActivated=false;h.state.lastRecvTime=undefined;$(e).trigger("activatingClient.chatmore",["start",undefined,{server:h.state.server,port:h.state.port}]);var m=true;var l=false;var k=function(n){$(e).trigger("activatingClient.chatmore",["error",n,{server:h.state.server,port:h.state.port}])};var j=function(p,n,o){k("Error during activation: "+n+", "+o);l=true};$.ajax("init.php",{async:false,type:"POST",cache:false,dataType:"json",data:{connect:0,viewKey:d,server:h.state.server,port:h.state.port},success:function(n){try{f.processMessages.call(h,n);$.each(n,function(p,q){if(q.type==="servermsg"){if(q.code===200){m=false}else{if(q.code>400){k(q.message);l=true}}}})}catch(o){if(window.console){console.error("Exception caught while processing messages:");console.error(n);console.error(o)}}},error:j});if(l){return}if(m){$(e).trigger("activatingClient.chatmore",["connecting",undefined,{server:h.state.server,port:h.state.port}])}else{$(e).trigger("activatingClient.chatmore",["resuming",undefined,{server:h.state.server,port:h.state.port}])}$.ajax("init.php",{type:"POST",cache:false,dataType:"json",data:{connect:1,viewKey:d},success:function(o){try{f.processMessages.call(h,o);if($.grep(o,function(q){return q.type==="servermsg"&&q.code===200}).length){$(e).trigger("activatingClient.chatmore",["activated",undefined,{server:h.state.server,port:h.state.port}]);h.state.isActivated=true;if(m){h.register(h.state.nick,h.state.realname)}var n=function(){if(f.pauseRecv){setTimeout(n,100)}else{f.pollHandle=undefined;f.pollXhr=$.ajax("recv.php",{cache:false,data:{viewKey:d},dataType:"json",success:function(q){if(typeof(q)==="object"){try{if(window.console){console.debug("msg count: "+q.length)}f.processMessages.call(h,q)}catch(r){if(window.console){console.error("Exception caught while processing messages:");console.error(q);console.error(r)}}}else{if(window.console){console.warn("Got invalid data:");console.warn(q)}}},complete:function(){f.pollXhr=undefined;if(h.state.isActivated){f.pollHandle=setTimeout(n,100)}}})}};setTimeout(n,0);$(e).trigger("activatedClient.chatmore",[{server:h.state.server,port:h.state.port}])}else{$(e).trigger("activatingClient.chatmore",["error","Error during activation",{server:h.state.server,port:h.state.port}])}}catch(p){if(window.console){console.error("Exception caught while processing messages:");console.error(o);console.error(p)}}},error:j})};h.deactivateClient=function(){if(h.state.isActivated){$(e).trigger("deactivatingClient.chatmore");h.state.isActivated=false;if(f.pollHandle!==undefined){clearTimeout(f.pollHandle)}f.pollHandle=undefined;if(f.pollXhr!==undefined){f.pollXhr.abort()}f.pollXhr=undefined;$(e).trigger("deactivatedClient.chatmore")}};h.sendMsg=function(k,l){var j=function(n){var m=function(){if(n<h.options.maxResendAttempts){if(window.console){console.warn("Resending: "+k)}var o=n>0?3000:100;setTimeout(function(){j(n+1)},o)}};$(e).trigger("sendingMessage.chatmore",[k,n]);$.ajax("send.php",{async:true,type:"POST",dataType:"json",cache:false,data:{viewKey:d,msg:k},success:function(o){if(l){l(k)}$(e).trigger("sentMessage.chatmore",[k,n]);if(typeof(o)==="object"){try{f.processMessages.call(h,o)}catch(p){if(window.console){console.error("Exception caught while processing messages:");console.error(o);console.error(p)}}}else{if(window.console){console.warn("Got invalid data:");console.warn(o)}m();return false}},error:function(o,p){$(e).trigger("errorSendingMessage.chatmore",[p,k,n]);m()}})};j(0)};h.register=function(j,k){h.state.nick=j;h.state.ident=Math.floor(Math.random()*100000000);h.state.realname=k;h.state.isRegistered=false;h.state.registrationAttemptCount=1;h.state.isModified=true;if(window.console){console.log('Registering user "'+h.state.nick+'" ('+h.state.realname+') on IRC server "'+h.state.server+":"+h.state.port+'"')}h.sendMsg("USER "+h.state.ident+" 0 * :"+h.state.realname);h.sendMsg("NICK "+h.state.nick)};h.sendChannelMsg=function(k,j){this.sendMsg("PRIVMSG "+k+" "+j)};h.sendPrivateMsg=function(j,k){this.sendMsg("PRIVMSG "+j+" "+k)};h.sendChannelAction=function(l,k){var j=String.fromCharCode(1);this.sendMsg("PRIVMSG "+l+" "+j+"ACTION "+k+j)};h.sendPrivateAction=function(j,l){var k=String.fromCharCode(1);this.sendMsg("PRIVMSG "+j+" "+k+"ACTION "+l+k)};h.sendChannelNotice=function(k,j){this.sendMsg("NOTICE "+k+" "+j)};h.sendPrivateNotice=function(j,k){this.sendMsg("NOTICE "+j+" "+k)};h.renameNick=function(j,k){$.each(h.state.channels,function(l,m){if(m.members[j]!==undefined){m.members[k]=m.members[j];m.removeMember(j)}});h.state.users[k]=h.state.users[j];h.state.removeUser(j);h.state.isModified=true};h.stricmp=function(k,j){return k.toLocaleLowerCase().localeCompare(j.toLocaleLowerCase())};h.isChannel=function(j){return j.match(/^[#&+!][^\s,:\cg]+/)}};(function(){var b={};var a={layouts:function(){return b}};var c=function(d){return d===undefined||d===null||d===""};$.chatmore=function(){var e=arguments[0];var d=Array.prototype.slice.call(arguments,1);return a[e].apply(null,d)};$.fn.chatmore=function(){if(arguments.length===0||typeof(arguments[0])==="object"){var h=arguments.length>0?arguments[0]:{};var g={port:6667,title:document.title,viewKey:"",nick:"user"+Math.floor(Math.random()*10000),quitMessage:"Chatmore IRC client",reactivateAttempts:6,reactivateDelay:10,layout:undefined};$.extend(g,h);if(c(g.realname)){g.realname=g.nick}if(typeof(g.channel)==="object"){autoJoinChannels=g.channel}else{if(!c(g.channel)){autoJoinChannels.push(g.channel)}}var d=function(){if(g.layout===undefined){if("default" in b){return b["default"]}else{for(var j in b){if(data.propertyIsEnumerable(prop)){return b[j]}}if(window.console){console.warn("Error initializing Chatmore:  No layout plugins have been loaded!")}return false}}else{return b[g.layout]}};var e={ircElement:$(this),irc:undefined,options:g,autoJoinChannels:[],prevState:undefined,msgSenders:[],autoCompleteReplyIndex:undefined,autoCompletePrefix:undefined,autoCompleteSuggest:undefined,enableAutoReactivate:true,reactivateAttempts:0,isPendingActivation:false,userEntryHistory:[""],userEntryHistoryIndex:undefined,layoutPlugin:d(),cmdDefs:{clear:{helpUsage:"Usage: /clear",helpText:"Clear the chat console.",parseParam:function(){},exec:function(j){e.ircElement.find(".ircConsole .content").html("")}},cleartopic:{helpUsage:"Usage: /cleartopic",helpText:"Clear the selected channel's topic.",parseParam:function(k,j){if(!e.irc.state.isActivated){j.error="Error: Must be connected to clear the topic.";return false}},exec:function(j){e.irc.sendMsg("TOPIC "+e.irc.target()+" :")}},connect:{helpUsage:"Usage: /connect",helpText:"Reconnect after disconnection.",parseParam:function(){},exec:function(j){if(e.isPendingActivation){j.error="Error: Cannot reconnect while connection attempt is pending.  Enter /quit to abort connection attempt.";return false}else{if(e.irc.state.isActivated){j.error="Error: Cannot reconnect while still connected.";return false}}e.irc.activateClient()}},help:{helpUsage:"Usage: /help &lt;command&gt;",helpText:["Show help for client commands.","Commands:"," clear - Clear the chat console"," cleartopic - Clear the channel's topic"," connect - Reconnect to IRC server"," join - Join a channel"," kick - Kick user from channel"," leave - Leave a channel"," list - Get channel listing"," me - Send an action message"," motd - Get the server message of the day"," msg - Send a private message"," nick - Change your nick"," notice - Send a notice to a nick or channel"," query - Select a target for messaging"," quit - Quit IRC session"," quote - Send raw IRC message"," time - Get the server time"," topic - Get or set the channel's topic"," who - Get info on a nick"],parseParam:function(k,j){if(k===undefined){k="help"}if(e.cmdDefs[k]===undefined){j.error='Error: Cannot get help on unknown command "'+k+'".';return false}j.cmd=k},exec:function(k){var j=e.cmdDefs[k.cmd];e.writeTmpl("help",{message:j.helpUsage});if(typeof(j.helpText)==="object"){$.each(j.helpText,function(l,m){e.writeTmpl("help",{message:m})})}else{e.writeTmpl("help",{message:j.helpText})}}},join:{helpUsage:"Usage: /join &lt;#channel&gt; [key]",helpText:"Join a channel.  Include a key if the channel requires it to join.",parseParam:function(l,j){if(l===undefined){j.error=e.cmdDefs.join.helpUsage;return false}var k=l.split(/\s+/,2);j.channel=k[0].replace(/^([^#&+!])/,"#$1");if(k[1]!==undefined){j.key=k[1]}if(!e.irc.state.isActivated){j.error="Error: Must be connected to join a channel.";return false}},exec:function(j){e.joinChannel(j.channel,j.key)}},kick:{helpUsage:"Usage: /kick &gt;nick&lt; [comment]",helpText:"Kick user from channel",parseParam:function(n,l){var k=e.cmdDefs.kick.helpUsage;var j=/^(\S+)(\s+(.+))?/.exec(n);if(j===null){l.error=k;return false}l.channel=e.irc.target();l.nick=j[1];l.comment=j[3];if(!e.irc.state.isActivated){l.error="Error: Must be connected to kick a user.";return false}},exec:function(j){if(j.comment!==undefined){e.irc.sendMsg("KICK "+j.channel+" "+j.nick+" :"+j.comment)}else{e.irc.sendMsg("KICK "+j.channel+" "+j.nick)}}},leave:{helpUsage:"Usage: /leave [#channel] [comment]",helpText:["Leave a channel.","If channel omitted, leaves channel currently selected by /query."],parseParam:function(l,k){if(l===undefined){if(e.irc.target()===undefined){k.error=e.cmdDefs.leave.helpUsage;return false}else{k.channel=e.irc.target()}}else{var j=/^(\S+)(\s+(.+))?\s*$/.exec(l);k.channel=j[1].replace(/^([^#&+!])/,"#$1");if(j[3]!==undefined){k.comment=j[3]}}if(!e.irc.state.isActivated){k.error="Error: Must be connected to leave a channel.";return false}},exec:function(j){if(j.comment!==undefined){e.irc.sendMsg("PART "+j.channel+" :"+j.comment)}else{e.irc.sendMsg("PART "+j.channel)}}},list:{helpUsage:"Usage: /list [#channel [, #channel ...] ] [server]",helpText:"Get channel listing.",parseParam:function(l,k){if(l===undefined){}else{var j=/^([#&+!][^\s,:\cg]+(\s*,\s*[#&+!][^\s,:\cg]+)*)(\s+(\S+))?\s*$/.exec(l);if(j!==null){k.channels=j[1].split(/\s*,\s*/);if(j[4]!==undefined){k.server=j[4]}}else{j=/^(\S+)\s*$/.exec(l);if(j!==null){k.server=j[1]}else{k.error=e.cmdDefs.list.helpUsage;return false}}}if(!e.irc.state.isActivated){k.error="Error: Must be connected to get the channel listing.";return false}},exec:function(j){if(j.channels!==undefined){if(j.server!==undefined){e.irc.sendMsg("LIST "+j.channels.join(",")+" "+j.server)}else{e.irc.sendMsg("LIST "+j.channels.join(","))}}else{if(j.server!==undefined){e.irc.sendMsg("LIST "+j.server)}else{e.irc.sendMsg("LIST")}}}},me:{helpUsage:"Usage: /me &lt;message&gt;",helpText:"Send an action message to currently selected channel or nick.",parseParam:function(l,k){var j=e.cmdDefs.msg.helpUsage;if(l===undefined){k.error=j;return false}k.target=e.irc.target();k.message=l;if(!e.irc.state.isActivated){k.error="Error: Must be connected to send an action message.";return false}},exec:function(j){if(e.isChannel(j.target)){e.irc.sendChannelAction(j.target,j.message);e.writeTmpl("outgoingChannelAction",{msg:{prefixNick:e.irc.state.nick,prefixUser:e.irc.state.ident,info:{target:j.target,text:j.message}}})}else{e.irc.sendPrivateAction(j.target,j.message);e.writeTmpl("outgoingPrivateAction",{msg:{prefixNick:e.irc.state.nick,prefixUser:e.irc.state.ident,info:{target:j.target,text:j.message}}})}}},mode:{helpUsage:"Usage: /mode &lt;nick | #channel&gt; [ &lt;+mode | -mode&gt; [parameters] ]",helpText:["Get or change user or channel mode.","Available user modes: http://tools.ietf.org/html/rfc2812#section-3.1.5","Available channel modes: http://tools.ietf.org/html/rfc2811#section-4"],parseParam:function(n,l){var k=e.cmdDefs.mode.helpUsage;var j=/^(\S+)(\s+(\S+(\s+\S+)*))?\s*$/.exec(n);if(j===null){l.error=k;return false}l.target=j[1];if(j[3]!==undefined){l.modes=j[3].split(/\s+/)}if(!e.irc.state.isActivated){l.error="Error: Must be connected to change mode.";return false}},exec:function(j){if(j.modes!==undefined){e.irc.sendMsg("MODE "+j.target+" "+j.modes.join(" "))}else{e.irc.sendMsg("MODE "+j.target)}}},motd:{helpUsage:"Usage: /motd [server]",helpText:["Get the server message of the day.","If server parameter is omitted, query current server."],parseParam:function(k,j){j.server=k;if(!e.irc.state.isActivated){j.error="Error: Must be connected to get server motd.";return false}},exec:function(j){if(j.server!==undefined&&j.server.length>0){e.irc.sendMsg("MOTD "+j.server)}else{e.irc.sendMsg("MOTD")}}},msg:{helpUsage:"Usage: /msg &lt;nick|#channel&gt; &lt;message&gt;",helpText:"Send a private message to a nick.",parseParam:function(n,l){var k=e.cmdDefs.msg.helpUsage;if(n===undefined){l.error=k;return false}var j=/^(\S+)\s+(.+)$/.exec(n);if(j===null||j.length!==3){l.error=k;return false}l.target=j[1];l.message=j[2];if(!e.irc.state.isActivated){l.error="Error: Must be connected to send a message.";return false}},exec:function(j){if(e.isChannel(j.target)){e.irc.sendChannelMsg(j.target,j.message);e.writeTmpl("outgoingChannelMsg",{msg:{prefixNick:e.irc.state.nick,prefixUser:e.irc.state.ident,info:{target:j.target,text:j.message}}})}else{e.irc.sendPrivateMsg(j.target,j.message);e.addToMsgSenders(j.target);e.writeTmpl("outgoingPrivateMsg",{msg:{prefixNick:e.irc.state.nick,prefixUser:e.irc.state.ident,info:{target:j.target,text:j.message}}})}}},nick:{helpUsage:"Usage: /nick &lt;nickname&gt;",helpText:"Change your nick.",parseParam:function(l,j){if(l===undefined){j.error=e.cmdDefs.nick.helpUsage;return false}var k=l.split(/\s+/,1);j.nick=k[0];if(!e.irc.state.isActivated){j.error="Error: Must be connected to change your nickname.";return false}},exec:function(j){e.irc.sendMsg("NICK "+j.nick)}},notice:{helpUsage:"Usage: /notice &lt;nick|#channel&gt; &lt;message&gt;",helpText:"Send a notice to a nick or channel.",parseParam:function(n,l){var k=e.cmdDefs.msg.helpUsage;if(n===undefined){l.error=k;return false}var j=/^(\S+)\s+(.+)$/.exec(n);if(j===null||j.length!==3){l.error=k;return false}l.target=j[1];l.message=j[2];if(!e.irc.state.isActivated){l.error="Error: Must be connected to send a notice.";return false}},exec:function(j){if(e.isChannel(j.target)){e.irc.sendChannelNotice(j.target,j.message);e.writeTmpl("outgoingChannelNotice",{msg:{prefixNick:e.irc.state.nick,prefixUser:e.irc.state.ident,info:{target:j.target,text:j.message}}})}else{e.irc.sendPrivateNotice(j.target,j.message);e.writeTmpl("outgoingPrivateNotice",{msg:{prefixNick:e.irc.state.nick,prefixUser:e.irc.state.ident,info:{target:j.target,text:j.message}}})}}},query:{helpUsage:"Usage: /query &lt;nick|#channel&gt;",helpText:"Select a nick or channel to send messages.",parseParam:function(l,j){if(l===undefined){j.error=e.cmdDefs.query.helpUsage;return false}var k=l.split(/\s+/,1);j.target=k[0];if(!e.irc.state.isActivated){j.error="Error: Must be connected to query a target.";return false}},exec:function(j){e.queryTarget(j.target)}},quit:{helpUsage:"Usage: /quit [comment]",helpText:"Quit IRC session.",parseParam:function(k,j){j.comment=k;if(!e.irc.state.isActivated&&!e.isPendingActivation){j.error="Error: Must be connected to quit.";return false}},exec:function(j){if(e.irc.target()!==undefined){e.queryTarget(undefined)}var k=j.comment!==undefined?j.comment:e.options.quitMessage;e.enableAutoReactivate=false;if(e.isPendingActivation){e.isPendingActivation=false;e.writeTmpl("error",{message:"Server connection aborted."})}else{e.irc.sendMsg("QUIT :"+k)}}},quote:{helpUsage:"Usage: /quote &gt;IRC request message&lt;",helpText:"Send a raw IRC request based on RFC2812.",parseParam:function(k,j){j.param=k;if(!e.irc.state.isActivated){j.error="Error: Must be connected to send a raw IRC request.";return false}if(c(j.param)){j.error="Missing parameter to /quote.";return false}},exec:function(j){e.irc.sendMsg(j.param)}},time:{helpUsage:"Usage: /time [server]",helpText:["Get the server time.","If server parameter is omitted, query current server."],parseParam:function(k,j){j.server=k;if(!e.irc.state.isActivated){j.error="Error: Must be connected to get server time.";return false}},exec:function(j){if(j.server!==undefined&&j.server.length>0){e.irc.sendMsg("TIME "+j.server)}else{e.irc.sendMsg("TIME")}}},topic:{helpUsage:"Usage: /topic [message]",helpText:"Get or set the selected channel's topic",parseParam:function(k,j){j.topic=k;if(e.irc.target()===undefined){j.error="Error: No target selected.  Doubleclick a channel or nick on the side bar or enter: /query &lt;nick|#channel&gt;.";return false}if(!e.irc.state.isActivated){j.error="Error: Must be connected to get or set the topic.";return false}},exec:function(j){if(j.topic===undefined){e.irc.sendMsg("TOPIC "+e.irc.target())}else{e.irc.sendMsg("TOPIC "+e.irc.target()+" :"+j.topic)}}},who:{helpUsage:"Usage: /who &lt;nick | channel&gt;",helpText:"Get info on a nick or all users in a channel.",parseParam:function(k,j){j.target=k;if(!e.irc.state.isActivated){j.error="Error: Must be connected to get WHO information.";return false}if(c(j.target)){j.error="Missing parameter to /quote.";return false}},exec:function(j){e.irc.sendMsg("WHO "+j.target)}}},sendLine:function(p){var j=/^\/(\S+)(\s+(.+))?/.exec(p);if(j){var l=j[1].toLowerCase();var o=j[3];if(e.cmdDefs[l]===undefined){e.writeTmpl("error",{message:'Error: Unknown client command "'+l+'".'})}else{var n={};var k=e.cmdDefs[l];if(k.parseParam&&k.parseParam(o,n)===false){if(n.error){e.writeTmpl("error",{message:n.error})}}else{k.exec(n)}}}else{if(e.irc.state.isActivated){if(e.irc.target()!==undefined){p=p.replace(/([\n\r])/gm,"");if(p.length>0){e.sendLine("/msg "+e.irc.target()+" "+p)}}else{e.writeTmpl("error",{message:"Error: No target selected.  Use: /query <nick|#channel> or /join <#channel>."})}}else{e.writeTmpl("error",{message:"Error: Cannot send message, client not activated."})}}},getShortTimestamp:function(){var j=new Date();return j.getHours()+":"+e.padZero(j.getMinutes(),2)},getLongTimestamp:function(){return new Date().toLocaleString()},padZero:function(m,k){var l=new Array(k+1).join("0");var j=""+l+m;return j.substring(j.length-k)},formatTime:function(j){var k=new Date();k.setTime(j*1000);return k.toLocaleString()},isChannel:function(j){return j.match(/^[#&+!][^\s,:\cg]+/)},stricmp:function(k,j){return k.toLocaleLowerCase().localeCompare(j.toLocaleLowerCase())},writeTmpl:function(j,k){e.layoutPlugin.writeTemplate(e,j,k)},addToMsgSenders:function(j){if(e.stricmp(j,e.irc.state.nick)!==0){e.msgSenders=$.grep(e.msgSenders,function(k){return e.stricmp(k,j)!==0});e.msgSenders.unshift(j);if(e.autoCompleteReplyIndex!==undefined){e.autoCompleteReplyIndex++}}},startsWith:function(j,l,k){return j.length>=l.length&&k(j.substr(0,l.length),l)===0},getNextMatch:function(m,j,l){if(m.length>0){if(j===undefined||j===null){return m[0]}for(var k in m){var n=m[k];if(l(n,j)>0){return n}}return m[0]}else{return undefined}},clearSelection:function(){if(window.getSelection){window.getSelection().removeAllRanges()}else{if(document.selection){document.selection.empty()}}},joinChannel:function(k,j){if(e.irc.state.channels[k]!==undefined){e.queryTarget(k)}else{if(j!==undefined){e.irc.sendMsg("JOIN "+k+" "+j)}else{e.irc.sendMsg("JOIN "+k)}}},queryTarget:function(k){if(window.console){console.log("queryTarget("+k+")")}var j=e.irc.target();if(k!==j){e.irc.target(k);e.writeTmpl(k===undefined?"queryOff":"query",{target:k,prevTarget:j});e.ircElement.find(".targetFragment").fadeOut(null,function(){e.ircElement.find(".targetLabel").text(k);if(k!==undefined&&k!==null){var l=e.isChannel(k);e.ircElement.find(".targetLabel").removeClass(l?"nick":"channel").addClass(l?"channel":"nick");e.ircElement.find(".targetFragment").fadeIn()}})}},getJoinedChannels:function(){var j=[];if(e.irc.state!==undefined){j=$.map(e.irc.state.channels,function(l,k){return k})}return j.sort(e.stricmp)},getChannelMembers:function(k){var j=[];if(e.irc.state!==undefined){var l=e.irc.state.channels[k];if(l!==undefined){j=$.map(l.members,function(m,n){return n})}}return j.sort(e.stricmp)},getLength:function(l){if(l.length){return l.length}else{if(Object.keys){return Object.keys(l).length}else{var k=0;for(var j in l){if(l.hasOwnProperty(j)){k++}}return k}}},clone:function(k){var j=(k instanceof Array)?[]:{};for(key in k){j[key]=(k[key]&&typeof k[key]==="object")?e.clone(k[key]):k[key]}return j},acceptAutoComplete:function(){if(e.autoCompleteReplyIndex!==undefined||e.autoCompletePrefix!==undefined){e.ircElement.find(".userEntry").each(function(){this.selectionStart=this.selectionEnd;e.autoCompleteReplyIndex=undefined;e.autoCompletePrefix=undefined})}},rejectAutoComplete:function(){if(e.autoCompleteReplyIndex!==undefined||e.autoCompletePrefix!==undefined){e.ircElement.find(".userEntry").each(function(){var m=$(this).val();var l=this.selectionStart>1?m.substr(0,this.selectionStart):"";var k=this.selectionEnd<m.length?m.substr(this.selectionEnd):"";var j=this.selectionStart;$(this).val(l+k);this.selectionStart=j;this.selectionEnd=j});e.autoCompleteReplyIndex=undefined;e.autoCompletePrefix=undefined}},incrementAutoComplete:function(){var m=e.ircElement.find(".userEntry");var t=m.val();if(t===""||e.autoCompleteReplyIndex!==undefined){if(e.msgSenders.length){if(e.autoCompleteReplyIndex===undefined){e.autoCompleteReplyIndex=0}var t="/msg "+e.msgSenders[e.autoCompleteReplyIndex]+" ";m.val(t);m[0].selectionStart=0;m[0].selectionEnd=t.length;e.autoCompleteReplyIndex++;if(e.autoCompleteReplyIndex>=e.msgSenders.length){e.autoCompleteReplyIndex=0}}}else{var n=m[0].selectionEnd;if(e.autoCompletePrefix===undefined){var r=t.substr(n).match(/^\S+/);if(r!==null){n+=r[0].length}var q=/\S+$/.exec(t.substr(0,n));if(q!==null){e.autoCompletePrefix=q[0];e.autoCompleteSuggest=undefined}}else{var p="";if(m[0].selectionStart>0){p+=t.substr(0,m[0].selectionStart)}if(m[0].selectionEnd<t.length){p+=t.substr(m[0].selectionEnd)}t=p;m[0].selectionEnd=m[0].selectionStart;n=m[0].selectionStart}if(e.autoCompletePrefix!==undefined){var k=e.irc.state.nick;if(e.isChannel(e.autoCompletePrefix)){var o=$.grep(e.getJoinedChannels(),function(s){return e.startsWith(s,e.autoCompletePrefix,e.stricmp)&&e.stricmp(s,k)!==0});e.autoCompleteSuggest=e.getNextMatch(o,e.autoCompleteSuggest,e.stricmp);if(e.autoCompleteSuggest!==undefined){var p=t.substr(0,n).replace(/(\S+)$/,e.autoCompleteSuggest);t=p+t.substr(n);m.val(t);m[0].selectionStart=p.length-e.autoCompleteSuggest.length+e.autoCompletePrefix.length;m[0].selectionEnd=p.length}}else{if(e.irc.target()!==undefined&&e.isChannel(e.irc.target())){var l=$.grep(e.getChannelMembers(e.irc.target()),function(s){return e.startsWith(s,e.autoCompletePrefix,e.stricmp)&&e.stricmp(s,k)!==0});e.autoCompleteSuggest=e.getNextMatch(l,e.autoCompleteSuggest,e.stricmp);if(e.autoCompleteSuggest!==undefined){var p=t.substr(0,n).replace(/(\S+)$/,e.autoCompleteSuggest);var j=p.length-e.autoCompleteSuggest.length;if(j===0){p+=": "}t=p+t.substr(n);m.val(t);m[0].selectionStart=j+e.autoCompletePrefix.length;m[0].selectionEnd=p.length}}}}}},methods:{activateClient:function(){e.irc.activateClient();return e.ircElement},deactivateClient:function(){e.irc.deactivateClient();return e.ircElement},resize:function(k,j){e.layoutPlugin.resize(e,k,j);return e.ircElement},scrollToBottom:function(){e.layoutPlugin.scrollToBottom(e);return e.ircElement},isAtBottom:function(){return e.layoutPlugin.isAtBottom(e)},layouts:function(){return b},setLayout:function(j){if(j in b){if(e.layoutPlugin!==undefined){e.layoutPlugin.destroy(e)}e.layoutPlugin=b[j];e.layoutPlugin.initialize(e)}else{if(window.console){console.warn("Attempted to use Chatmore layout that does not exist: "+j)}}},onLocalMessage:function(j){e.ircElement.on("localMessage.chatmore",function(k,l){j.call(e.ircElement,k,l)});return e.ircElement},onStateChanged:function(j){e.ircElement.on("stateChanged.chatmore",function(k){j.call(e.ircElement,k,e.irc.state)});return e.ircElement},onProcessingMessage:function(j){e.ircElement.on("processingMessage.chatmore",function(k,l){j.call(e.ircElement,k,l)});return e.ircElement},onProcessedMessage:function(j){e.ircElement.on("processedMessage.chatmore",function(k,l){j.call(e.ircElement,k,l)});return e.ircElement},onSendingMessage:function(j){e.ircElement.on("sendingMessage.chatmore",function(l,k,m){j.call(e.ircElement,l,k,m)});return e.ircElement},onSentMessage:function(j){e.ircElement.on("sentMessage.chatmore",function(l,k,m){j.call(e.ircElement,l,k,m)});return e.ircElement},onErrorSendingMessage:function(j){e.ircElement.on("errorSendingMessage.chatmore",function(l,n,k,m){j.call(e.ircElement,l,n,k,m)});return e.ircElement},onActivatingClient:function(j){e.ircElement.on("activatingClient.chatmore",function(m,k,l,n){j.call(e.ircElement,m,k,l,n)});return e.ircElement},onDeactivatingClient:function(j){e.ircElement.on("deactivatingClient.chatmore",function(k){j.call(e.ircElement,k)});return e.ircElement}}};e.ircElement.empty().off().data("chatmore",e);e.layoutPlugin.initialize(e);e.cmdDefs.j=e.cmdDefs.join;e.cmdDefs.k=e.cmdDefs.kick;e.cmdDefs.l=e.cmdDefs.leave;e.cmdDefs.m=e.cmdDefs.msg;e.cmdDefs.n=e.cmdDefs.notice;e.cmdDefs.q=e.cmdDefs.query;e.ircElement.on("localMessage.chatmore",function(o,l,k,n){if(window.console){console.log("UI event: localMessage")}switch(n.code){case"R1":e.writeTmpl("retryRegistration",{});break;case"RE1":var j=n.maxRegistrationAttempts>1?"Registration failed.  Unable to register with a unique nickname after "+n.maxRegistrationAttempts+" attempts.  Please reconnect with a unique nickname.":"Registration failed.  Please reconnect with a unique nickname.";e.writeTmpl(k,{message:j});e.enableAutoReactivate=false;e.irc.deactivateClient();break;default:e.writeTmpl(k,{message:l})}e.layoutPlugin.onLocalMessage(e,l,k,n)}).on("processingMessage.chatmore",function(j,k){if(k.type==="recv"){e.irc.state.addUser(k.prefixNick);if(k.command==="433"){e.writeTmpl("nickInUse",{msg:k})}}e.layoutPlugin.onProcessingMessage(e,k)}).on("processedMessage.chatmore",function(k,l){if(l.type==="recv"){switch(l.command){case"PRIVMSG":if(e.stricmp(l.info.target,e.irc.state.nick)===0){e.writeTmpl(l.info.isAction?"incomingPrivateAction":"incomingPrivateMsg",{msg:l});if(!l.info.isAction){e.addToMsgSenders(l.prefixNick)}}else{e.writeTmpl(l.info.isAction?"incomingChannelAction":"incomingChannelMsg",{msg:l})}break;case"NOTICE":if(e.stricmp(l.info.target,e.irc.state.nick)===0){e.writeTmpl("incomingPrivateNotice",{msg:l});e.addToMsgSenders(l.prefixNick)}else{e.writeTmpl("incomingChannelNotice",{msg:l})}break;case"JOIN":e.writeTmpl("join",{msg:l});if(e.stricmp(l.prefixNick,e.irc.state.nick)===0){e.queryTarget(l.info.channel)}break;case"PART":e.writeTmpl("leave",{msg:l});break;case"KICK":var j=$.extend(true,{},l);delete j.info.kicks;$.each(l.info.kicks,function(m,n){j.info.kick=n;e.writeTmpl("kick",{msg:j})});break;case"MODE":e.writeTmpl("mode",{msg:l});break;case"NICK":e.writeTmpl("nick",{msg:l});if(e.irc.target()!==undefined&&e.stricmp(l.prefixNick,e.irc.target())===0){e.queryTarget(l.info.nick)}break;case"TOPIC":e.writeTmpl("changeTopic",{msg:l});break;case"QUIT":e.writeTmpl("quit",{msg:l});break;case"ERROR":e.writeTmpl("error",{message:l.info.message});break;case"001":if(e.autoJoinChannels!==undefined&&e.autoJoinChannels.length>0){$.each(e.autoJoinChannels.sort(e.stricmp).reverse(),function(m,n){if(window.console){console.log("Joining channel: "+n)}e.irc.sendMsg("JOIN "+n)})}break;case"252":case"253":case"254":e.writeTmpl("serverMsg",{number:l.info.number,message:l.info.message});break;case"322":e.writeTmpl("list",{msg:l});break;case"331":e.writeTmpl("notopic",{msg:l});break;case"332":e.writeTmpl("topic",{msg:l});break;case"333":e.writeTmpl("topicSetBy",{msg:l});break;case"352":e.writeTmpl("who",{msg:l});break;case"391":e.writeTmpl("serverTime",{msg:l});break;case"403":e.writeTmpl("serverMsg",{message:l.info.message});break;case"477":e.writeTmpl("serverMsg",{channel:l.info.channel,message:l.info.message});break;case"004":case"005":case"323":case"324":case"353":case"366":case"433":break;default:if(l.info.message!==undefined){e.writeTmpl("serverMsg",{message:l.info.message})}break}}e.layoutPlugin.onProcessedMessage(e,l)}).on("stateChanged.chatmore",function(n){if(window.console){console.log("UI event: stateChanged")}if(window.console){console.log(e.irc.state)}var l=e.irc.state;if(e.prevState===undefined||e.stricmp(l.nick,e.prevState.nick)!==0){if(window.console){console.log("Nick changed.")}var j=e.ircElement.find(".nickLabel");j.fadeOut(null,function(){j.text(l.nick);j.fadeIn()})}var m=e.irc.target();if(m!==undefined){var o=e.isChannel(m);if(o&&!(m in l.channels)){var k=e.getJoinedChannels()[0];if(window.console){console.log("Selected channel is no longer joined.  Selecting first channel: "+k)}e.queryTarget(k)}else{if(!o&&!(m in l.users)){var k=e.getJoinedChannels()[0];if(window.console){console.log("Selected user is no longer available.  Selecting first channel: "+k)}e.queryTarget(k)}}}e.layoutPlugin.onStateChanged(e);e.prevState=e.clone(e.irc.state)}).on("sendingMessage.chatmore",function(k,j,l){e.layoutPlugin.onSendingMessage(e,j,l)}).on("errorSendingMessage.chatmore",function(k,m,j,l){if(window.console){console.warn("Error sending message: "+j+", resendCount: "+l);console.warn(m)}e.layoutPlugin.onErrorSendingMessage(e,m,j,l);if(l==e.irc.options.maxResendAttempts){e.writeTmpl("error",{message:"Unable to send message: "+j})}else{if(l==2){e.writeTmpl("error",{message:"Error sending message to server, will try again: "+j})}}}).on("activatingClient.chatmore",function(n,k,l,o){switch(k){case"start":if(window.console){console.log("UI event: activatingClient start")}e.isPendingActivation=true;e.ircElement.find(".userEntry").focus();break;case"connecting":if(window.console){console.log("UI event: activatingClient connecting")}var m=o.server+(o.port!=6667?(":"+o.port):"");e.writeTmpl("clientMsg",{message:"Connecting to IRC server "+m});break;case"resuming":if(window.console){console.log("UI event: activatingClient resuming")}var m=o.server+(o.port!=6667?(":"+o.port):"");e.writeTmpl("clientMsg",{message:"Resuming existing IRC connection to "+m});var j=e.autoJoinChannels.sort(e.stricmp);if(j.length>0){$.each(j,function(p,q){if(window.console){console.log("Rejoining channel: "+q)}e.irc.sendMsg("JOIN "+q);e.irc.sendMsg("NAMES "+q)});e.queryTarget(j[0])}break;case"activated":if(window.console){console.log("UI event: activatingClient activated")}e.ircElement.removeClass("deactivated").addClass("activated");e.reactivateAttempts=0;e.enableAutoReactivate=true;e.isPendingActivation=false;break;case"error":if(window.console){console.log("UI event: activatingClient error")}e.isPendingActivation=false;e.writeTmpl("error",{message:l});break}e.layoutPlugin.onActivatingClient(e,k,l,o)}).on("deactivatingClient.chatmore",function(){if(window.console){console.log("UI event: deactivatingClient")}e.ircElement.removeClass("activated").addClass("deactivated");if(e.enableAutoReactivate){if(e.reactivateAttempts<e.options.reactivateAttempts){e.isPendingActivation=true;e.writeTmpl("error",{message:"Server connection lost.  Retrying connection in "+e.options.reactivateDelay+" seconds...  Enter /quit to abort."});setTimeout(function(){if(e.enableAutoReactivate){e.reactivateAttempts++;e.irc.activateClient()}},e.options.reactivateDelay*1000)}else{e.isPendingActivation=false;e.writeTmpl("error",{message:"Server connection lost and will not reconnect.  Sorry about that."})}}else{e.isPendingActivation=false;e.writeTmpl("error",{message:"Server connection closed."})}e.layoutPlugin.onDeactivatingClient(e)});e.ircElement.find(".userEntry").click(function(j){e.acceptAutoComplete()}).keydown(function(k){if(!k.altKey&&!k.ctrlKey&&!k.shiftKey){if(k.keyCode===13){if(e.autoCompleteReplyIndex!==undefined||e.autoCompletePrefix!==undefined){e.acceptAutoComplete()}else{e.userEntryHistory.unshift("");e.sendLine($(this).val());$(this).val("");e.userEntryHistoryIndex=undefined}return false}else{if(k.keyCode===27){e.rejectAutoComplete();return false}else{if(k.keyCode===9){e.incrementAutoComplete();return false}else{if(k.keyCode===38||k.keyCode===40){if(e.userEntryHistoryIndex===undefined&&e.userEntryHistory.length>1){e.userEntryHistoryIndex=0}if(e.userEntryHistoryIndex!==undefined){if(k.keyCode===38){e.userEntryHistoryIndex++;if(e.userEntryHistoryIndex>=e.userEntryHistory.length){e.userEntryHistoryIndex=0}}else{e.userEntryHistoryIndex--;if(e.userEntryHistoryIndex<0){e.userEntryHistoryIndex=e.userEntryHistory.length-1}}var j=e.userEntryHistory[e.userEntryHistoryIndex];$(this).val(j);this.selectionStart=j.length;this.selectionEnd=this.selectionStart}return false}}}}}}).keypress(function(j){if(!j.altKey&&!j.ctrlKey&&!j.shiftKey){if(j.keyCode===13||j.keyCode===27||j.keyCode===9||j.keyCode===38||j.keyCode===40){return false}}e.acceptAutoComplete();e.userEntryHistory[0]=$(this).val()+String.fromCharCode(j.which)}).focus();$.each(["onStateChanged","onLocalMessage","onProcessingMessage","onProcessedMessage","onSendingMessage","onErrorSendingMessage","onSentMessage","onActivatingClient","onDeactivatingClient"],function(j,k){if(k in g){e.ircElement.chatmore(k,g[k])}});e.irc=new chatmore(e.ircElement[0],g.viewKey,g.server,g.port,g.nick,g.realname);if(g.activateImmediately){e.irc.activateClient()}return e.ircElement}else{var i=arguments[0];var f=Array.prototype.slice.call(arguments,1);var e=$(this).data("chatmore");return e.methods[i].apply(e,f)}}})();(function(){var v;var c={title:"<span>{{if messageCount == 1}}A new message has arrived! -- {{else messageCount > 1}}${messageCount} new messages have arrived! -- {{/if}}${self.options.title} - ${self.irc.state.server}:${self.irc.state.port}</span>",timestamp:'<span class="timestamp" title="${self.getLongTimestamp()}">[${self.getShortTimestamp()}]&nbsp;</span>',bullet:"&bull;&bull;&bull;",notePrefix:'<span class="prefix">{{tmpl "bullet"}}</span>',error:'{{tmpl "timestamp"}}<span class="error">{{tmpl "notePrefix"}} <span class="message">${message}</span></span>',usage:'{{tmpl "timestamp"}}<span class="usage">{{tmpl "notePrefix"}} <span class="message">${message}</span></span>',help:'{{tmpl "timestamp"}}<span class="help">{{tmpl "notePrefix"}} <span class="message">${message}</span></span>',serverMsg:'{{tmpl "timestamp"}}<span class="serverMsg">{{tmpl "notePrefix"}} {{if channel}}&lt;<span class="channel">${channel}</span>&gt; {{/if}}<span class="message">{{if number}}${number} {{/if}}${message}</span></span>',clientMsg:'{{tmpl "timestamp"}}<span class="clientMsg">{{tmpl "notePrefix"}} <span class="message">${message}</span></span>',outgoingChannelMsg:'{{tmpl "timestamp"}}<span class="channelMsg"><span class="prefix">&lt;<span class="channel">${msg.info.target}</span>:<span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.target)}">${msg.prefixNick}</span>&gt;</span> <span class="message">${msg.info.text}</span></span>',outgoingChannelAction:'{{tmpl "timestamp"}}<span class="channelMsg action"><span class="prefix">&lt;<span class="channel">${msg.info.target}</span>&gt; &bull; <span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.target)}">${msg.prefixNick}</span></span> <span class="message">${msg.info.text}</span></span>',outgoingChannelNotice:'{{tmpl "timestamp"}}<span class="channelNotice"><span class="prefix">-<span class="channel">${msg.info.target}</span>:<span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.target)}">${msg.prefixNick}</span>-</span> <span class="message">${msg.info.text}</span></span>',outgoingPrivateMsg:'{{tmpl "timestamp"}}<span class="privateMsg"><span class="prefix">&#x21E8; &bull;<span class="nick">${msg.info.target}</span>&bull;</span> <span class="message">${msg.info.text}</span></span>',outgoingPrivateAction:'{{tmpl "timestamp"}}<span class="privateMsg action"><span class="prefix">&#x21E8; &bull;<span class="nick">${msg.info.target}</span>&bull; <span class="nick">${msg.prefixNick}</span></span> <span class="message">${msg.info.text}</span></span>',outgoingPrivateNotice:'{{tmpl "timestamp"}}<span class="privateNotice"><span class="prefix">-<span class="nick">${msg.info.target}</span>-</span> <span class="message">${msg.info.text}</span></span>',incomingChannelMsg:'{{tmpl "timestamp"}}<span class="channelMsg"><span class="prefix">&lt;<span class="channel">${msg.info.target}</span>:<span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.target)}">${msg.prefixNick}</span>&gt;</span> <span class="message">${msg.info.text}</span></span>',incomingChannelAction:'{{tmpl "timestamp"}}<span class="channelMsg action"><span class="prefix">&lt;<span class="channel">${msg.info.target}</span>&gt; &bull; <span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.target)}">${msg.prefixNick}</span></span> <span class="message">${msg.info.text}</span></span>',incomingChannelNotice:'{{tmpl "timestamp"}}<span class="channelNotice"><span class="prefix">-<span class="channel">${msg.info.target}</span>:<span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.target)}">${msg.prefixNick}</span>-</span> <span class="message">${msg.info.text}</span></span>',incomingPrivateMsg:'{{tmpl "timestamp"}}<span class="privateMsg"><span class="prefix">&bull;<span class="nick">${msg.prefixNick}</span>&bull;</span> <span class="message">${msg.info.text}</span></span>',incomingPrivateAction:'{{tmpl "timestamp"}}<span class="privateMsg action"><span class="prefix">&bull; <span class="nick">${msg.prefixNick}</span></span> <span class="message">${msg.info.text}</span></span>',incomingPrivateNotice:'{{tmpl "timestamp"}}<span class="privateNotice"><span class="prefix">-<span class="nick">${msg.prefixNick}</span>-</span> <span class="message">${msg.info.text}</span></span>',queryOff:'{{tmpl "timestamp"}}<span class="queryMsg">{{tmpl "notePrefix"}} <span class="message">{{if self.isChannel(prevTarget)}}You are no longer talking on channel <span class="channel">${prevTarget}</span>{{else}}Ending conversation with <span class="nick">${prevTarget}</span>{{/if}}</span></span>',query:'{{tmpl "timestamp"}}<span class="queryMsg">{{tmpl "notePrefix"}} <span class="message">{{if self.isChannel(target)}}You are now talking on channel <span class="channel">${target}</span>{{else}}Starting conversation with <span class="nick">${target}</span>{{/if}}</span></span>',join:'{{tmpl "timestamp"}}<span class="JOIN"><span class="prefix">&lt;<span class="channel">${msg.info.channel}</span>&gt;</span> <span class="message"><span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.channel)}">${msg.prefixNick}</span> (${msg.prefixUser}@${msg.prefixHost}) has joined the channel</span></span>',leave:'{{tmpl "timestamp"}}<span class="PART"><span class="prefix">{{tmpl "bullet"}} &lt;<span class="channel">${msg.info.channel}</span>&gt;</span> <span class="message"><span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.channel)}">${msg.prefixNick}</span> has left the channel{{if !!msg.info.comment}}: ${msg.info.comment}{{/if}}</span></span>',kick:'{{tmpl "timestamp"}}<span class="KICK"><span class="prefix">{{tmpl "bullet"}} &lt;<span class="channel">${msg.info.kick.channel}</span>&gt;</span> <span class="message">{{if self.stricmp(self.irc.state.nick, msg.info.kick.nick) === 0}}You have been kicked from the channel by <span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.kick.channel)}">${msg.prefixNick}</span>{{else}}<span class="nick ${layout.getColorizeCSSClass(self, msg.info.kick.nick, msg.info.kick.channel)}">${msg.info.kick.nick}</span> has been kicked from the channel by <span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.kick.channel)}">${msg.prefixNick}</span>{{/if}}{{if msg.info.comment !== undefined && msg.info.comment !== msg.prefixNick}}: ${msg.info.comment}{{/if}}</span></span>',nick:'{{tmpl "timestamp"}}<span class="NICK">{{tmpl "notePrefix"}} <span class="message">{{if self.stricmp(self.irc.state.nick, msg.prefixNick) === 0}}Nick changed to <span class="nick">${msg.info.nick}</span>{{else}}<span class="nick">${msg.prefixNick}</span> is now known as <span class="nick">${msg.info.nick}</span>{{/if}}</span></span>',nickInUse:'{{tmpl "timestamp"}}<span class="serverMsg">{{tmpl "notePrefix"}} <span class="message">Nickname <span class="nick">${msg.info.nick}</span> is already in use.</span></span>',notopic:'{{tmpl "timestamp"}}<span class="TOPIC"><span class="prefix">{{tmpl "bullet"}} &lt;<span class="channel">${msg.info.channel}</span>&gt;</span> <span class="message no-decorate">No topic is set</span></span>',topic:'{{tmpl "timestamp"}}<span class="TOPIC"><span class="prefix">{{tmpl "bullet"}} &lt;<span class="channel">${msg.info.channel}</span>&gt;</span> <span class="message">{{if msg.info.topic !== undefined}}<span class="no-decorate">The current topic is:</span> <span class="topicMessage">${msg.info.topic}</span>{{else}}<span class="message no-decorate">No topic is set</span>{{/if}}</span></span>',changeTopic:'{{tmpl "timestamp"}}<span class="TOPIC"><span class="prefix">{{tmpl "bullet"}} &lt;<span class="channel">${msg.info.channel}</span>&gt;</span> <span class="message"><span class="no-decorate"><span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.channel)}">${msg.prefixNick}</span> {{if msg.info.topic == ""}}has cleared the topic</span>{{else}}has changed the topic to: </span><span class="topicMessage">${msg.info.topic}</span>{{/if}}</span></span>',topicSetBy:'{{tmpl "timestamp"}}<span class="TOPIC"><span class="prefix">{{tmpl "bullet"}} &lt;<span class="channel">${msg.info.channel}</span>&gt;</span> <span class="message no-decorate">Topic set by <span class="nick ${layout.getColorizeCSSClass(self, msg.info.nick, msg.info.channel)}">${msg.info.nick}</span> on <span class="time">${self.formatTime(msg.info.time)}</span></span></span>',who:'{{tmpl "timestamp"}}<span class="WHO">{{tmpl "notePrefix"}} <span class="message">WHO for <span class="nick ${layout.getColorizeCSSClass(self, msg.info.nick, msg.info.channel)}">${msg.info.nick}</span>: "${msg.info.realname}" ${msg.info.user}@${msg.info.host} on server ${msg.info.server}</span>',serverTime:'{{tmpl "timestamp"}}<span class="TIME">{{tmpl "notePrefix"}} <span class="message">Server time for <span class="server">${msg.info.server}</span>: <span class="time">${msg.info.timeString}</span></span></span>',quit:'{{tmpl "timestamp"}}<span class="QUIT">{{tmpl "notePrefix"}} <span class="message">Signoff: <span class="nick">${msg.prefixNick}</span> (${msg.info.message})</span></span>',error:'{{tmpl "timestamp"}}<span class="ERROR">{{tmpl "notePrefix"}} <span class="message">${message}</span></span>',mode:'{{tmpl "timestamp"}}<span class="MODE">{{tmpl "notePrefix"}} <span class="message">Mode change "<span class="modeString">${msg.info.mode}</span>" for {{if self.isChannel(msg.info.target)}}channel <span class="channel">${msg.info.target}</span> by <span class="nick ${layout.getColorizeCSSClass(self, msg.prefixNick, msg.info.target)}">${msg.prefixNick}</span></span>{{else}}user <span class="nick">${msg.info.target}</span> by <span class="nick">${msg.prefixNick}</span></span>{{/if}}</span>',list:'{{tmpl "timestamp"}}<span class="LIST">{{tmpl "notePrefix"}} <span class="message"><span class="no-decorate"><span class="channel">${msg.info.channel}</span> (${msg.info.memberCount}): </span>${msg.info.topic}</span></span>',retryRegistration:'{{tmpl "timestamp"}}<span class="clientMsg">{{tmpl "notePrefix"}} <span class="message no-decorate">Retrying registration with nickname <span class="nick">${self.irc.state.nick}</span></span></span>'};var m=/\b([a-z]{2,8}:\/\/([\w\-_]+(\.[\w\-_]+)*)(:\d+)?(\/[^\s\?\/<>]*)*(\?\&*([^\s=&#<>]+(=[^\s=&#<>]*)?(&[^\s=&#<>]+(=[^\s=&#<>]*)?)*)?)?(#\S+)?)/gi;var d=function(x,A){v.messageCount++;i(x);var C=x.ircElement.find(".ircConsole .content");var y;var B=function(F){var G=v.isAtBottom(x);for(var D=C.find(".line").length;D>=x.options.maximumConsoleLines;D--){C.find(".line").first().remove()}var I=F.find(".prefix .channel").text();F.closest(".channelMsg,.privateMsg,.TOPIC,.LIST,.serverMsg,.clientMsg").find(".message").each(function(){k(x,this);f(x,this);u(x,this,I)});F.find(".nick,.channel").hover(g,o).dblclick(function(){q.call(this,x)});F.closest(".channelMsg").find(".message .nick").filter(function(){return x.irc.state!==undefined&&x.stricmp($(this).text(),x.irc.state.nick)===0}).first().filter(function(){var J=F.find(".prefix .nick").text();return x.irc.state!==undefined&&x.stricmp(J,x.irc.state.nick)!==0}).each(function(){F.closest(".channelMsg").addClass("nickHighlight")});var E=$('<div class="line"/>').attr("mc",v.messageCount).append(F).appendTo(C);if(!v.isWindowFocused){if(v.blurMessageCount===(v.messageCount-1)){var H=x.ircElement.find(".ircConsole .content");H.find(".line.new").removeClass("new");H.find(".line.separator").remove();E.before('<div class="line separator"/>')}E.addClass("new").css("opacity","0.5")}if(G){v.scrollToBottom(x)}return E};if(typeof(A)==="object"){$.each(A,function(F,E){var D=$("<div/>").append(E);y=B(D.contents())})}else{var z=$("<div/>").append(A);y=B(z.contents())}return y};var n=function(A,x){var z;var y=[];if(A.nodeType===1){if(A.firstChild){A=A.firstChild;do{z=A.nextSibling;y=y.concat(n(A,x));A=z}while(A)}}else{if(A.nodeType===3){if(x===undefined||x(A)){y.push(A)}}}return y};var r=function(x){return n(x,function(y){if($(y).parent("a,.channel,.nick").length!==0||$(y).parents(".no-decorate").length!==0){return false}else{return true}})};var k=function(y,D){var x=r(D);for(var C=0;C<x.length;C++){var E=x[C];var z=false;var B=$(E).text().replace(m,function(F,G){z=true;trailingText=G.match(/[)>,\.;:'"]$/);if(trailingText!==null){G=G.substring(G,G.length-trailingText[0].length)}var H=$("<div/>").append($("<a/>").attr("href",G).attr("target","_blank").text(G));if(trailingText!==null){H.append(document.createTextNode(trailingText[0]))}return H.html()});if(z){var A=$("<span/>").append(B);$(E).replaceWith(A)}}};var u=function(I,y,E){var A;if(I.irc.state!==undefined){A=$.map(I.irc.state.users,function(K,J){return J})}if(A===undefined||A.length===0){return}var D=$.map(A,function(J){return J.replace(/([?*|.^$()\[\]{}\\/])/,"\\$1")}).join("|");var H=new RegExp("\\b("+D+")\\b","ig");var x=r(y);for(var B=0;B<x.length;B++){var z=x[B];var G=false;var C=$(z).text().replace(H,function(K,J){var L;if(E!==undefined&&I.isChannel(E)){if(I.irc.state.channels[E]!==undefined&&I.irc.state.channels[E].members[J]!==undefined){L=I.irc.state.channels[E].members[J].colorizeNumber}}G=true;if(L!==undefined){return'<span class="nick color'+L+'">'+J+"</span>"}else{return'<span class="nick">'+J+"</span>"}});if(G){var F=$("<span/>").append(C);$(z).replaceWith(F)}}};var f=function(y,D){var x=r(D);for(var C=0;C<x.length;C++){var E=x[C];var z=false;var B=$(E).text().replace(/(^|[\s,:\cg])(#[^\s,:\cg]+)\b/g,function(F,H,G){z=true;return H+'<span class="channel">'+G+"</span>"});if(z){var A=$("<span/>").append(B);$(E).replaceWith(A)}}};var j=function(y,x,z){var A=y.irc.state.channels[z];if(A===undefined){return}return A.members[x]!==undefined?A.members[x].colorizeNumber:undefined};var g=function(){$(this).addClass("ui-state-hover")};var o=function(){$(this).removeClass("ui-state-hover")};var q=function(x){if(x.irc.state.isActivated){var y=$(this).clone().children().remove().end().text();x.clearSelection();if(x.irc.state!==undefined&&x.stricmp(y,x.irc.state.nick)!==0){if(x.isChannel(y)){if(x.irc.state!==undefined&&x.irc.state.channels[y]===undefined){x.sendLine("/join "+y)}else{x.queryTarget(y)}}else{x.queryTarget(y)}x.ircElement.find(".userEntry").focus()}}};var w=function(x){if(!v.freezeSideBar){var y=x.ircElement.find(".sideBar ul.channelList");var z=y[0].scrollTop;y.empty();$.each(x.getJoinedChannels(),function(C,D){var E=x.irc.state.channels[D];var B=x.getLength(E.members);var A=$('<li><span class="channel">'+D+'</span><span class="memberCount">('+B+')</span><span class="leaveButton" title="Leave channel"></span></li>').find(".channel").attr("title",(E.topic!==undefined)?E.topic:"No topic set").end().find(".leaveButton").click(function(){if(x.irc.state.isActivated){$(this).parent("li").addClass("leaving");x.sendLine("/leave "+D)}}).end().appendTo(y);var F=$('<ul class="memberList"/>').appendTo(A);$.each(x.getChannelMembers(D),function(H,J){var G=E.members[J];var I=G.colorizeNumber;$('<li><span class="mode">'+G.mode+'</span><span class="nick color'+I+'">'+J+"</span></li>").appendTo(F)})});y[0].scrollTop=z;y.find(".nick,.channel").hover(g,o).dblclick(function(){q.call(this,x)})}};var l=function(z){var B=z.ircElement.find(".ircConsole");var E=z.ircElement.find(".ircConsole .content");var y=z.ircElement.find(".userEntrySection");var x=z.ircElement.find(".userEntryLine");var D=z.ircElement.find(".userEntry");var A=z.ircElement.find(".sideBar");var C=A.find(".channelList");E.width(B.width()).height(B.height());y.outerWidth(B.outerWidth());x.width(y.width());D.outerWidth(x.width());A.outerHeight(B.outerHeight()+y.outerHeight());C.height(A.height())};var e=function(){$.each(c,function(y,x){$.template(y,x)})};var a=function(x){var y=$.tmpl("title",{self:x,layout:v,messageCount:v.notificationMessageCount}).text();if(y!==document.title){document.title=y}};var i=function(x){if(!v.isWindowFocused){v.notificationMessageCount++;a(x)}};var s=function(){var x=document.location.hash.split(",");if(x[0]==""){return[]}else{return x}};var p=function(x){var y=x.sort().join(",");if(document.location.hash!==y){document.location.hash=y}};var b=function(){return Math.random().toString(36).substr(2,8)};var h=function(){return location.search.substring(1)};var t=function(A){var y={};var z=/([^&=]+)=([^&]*)/g;var x;while(x=z.exec(A)){y[decodeURIComponent(x[1])]=decodeURIComponent(x[2])}return y};toQueryString=function(x){var y=$.map(x,function(A,z){if(A===undefined||A===null){return encodeURIComponent(z)}else{return encodeURIComponent(z)+"="+encodeURIComponent(A)}});return y.join("&")};v={messageCount:0,notificationMessageCount:0,blurMessageCount:undefined,isWindowFocused:true,freezeSideBar:false,warnOnUnload:true,initialize:function(y,z){$(y.ircElement).addClass("chatmore").addClass("-fullpage-layout").addClass("ui-widget").append($('<div style="float:left;overflow:hidden"><div class="ircConsole ui-widget-content ui-corner-tl"><div class="content ui-corner-all"/></div><div class="userEntrySection ui-widget-content ui-corner-bl"><div class="userEntryModeLine"><div class="activationIndicator"/><div class="nickLabel nick"/><div class="targetFragment" style="display:none"><div class="targetLabel"/></div></div><div class="userEntryLine"><input type="text" class="userEntry" /></div></div></div><div class="sideBar ui-widget ui-widget-content ui-corner-right"><ul class="channelList"/></div>'));l(y);e(y);var x=s();if(x.length>0){y.autoJoinChannels=x}$(window).on("focus.chatmore_default",function(){setTimeout(function(){v.notificationMessageCount=0;a(y)},200);if(!v.isWindowFocused){v.isWindowFocused=true;y.ircElement.find(".userEntry").focus();if(v.blurMessageCount){var A=y.ircElement.find(".ircConsole .content > .line.new");A.fadeTo(2000,1,"easeOutExpo")}v.blurMessageCount=undefined}}).on("blur.chatmore_default",function(){v.isWindowFocused=false;v.blurMessageCount=v.messageCount}).on("resize.chatmore_default",function(){v.resize(y)}).on("beforeunload.chatmore_default",function(){if(v.warnOnUnload){return"You are about to navigate away from the Chatmore IRC client, which may disconnect from your session."}});v.resize(y)},destroy:function(){$(window).off(".chatmore_default")},writeTemplate:function(y,x,A){A.self=y;A.layout=v;var z=$("<div/>").append($.tmpl(x,A));return d(y,z.html())},resize:function(z,E,x){if(E&&x){var B=z.ircElement.find(".ircConsole");var A=z.ircElement.find(".sideBar");var y=z.ircElement.find(".userEntrySection");B.outerWidth(E-A.outerWidth()).outerHeight(x-y.outerHeight());l(z)}else{var D=z.ircElement.parent();var C=v.isAtBottom(z);v.resize(z,$(window).width()-D.outerWidth()+D.width(),$(window).height()-D.outerHeight()+D.height());if(C){v.scrollToBottom(z)}}},scrollToBottom:function(x){var y=x.ircElement.find(".ircConsole .content");y[0].scrollTop=y[0].scrollHeight},isAtBottom:function(x){var y=x.ircElement.find(".ircConsole .content");return(y[0].scrollTop+4)>=(y[0].scrollHeight-y[0].clientHeight)},onStateChanged:function(x){w(x);p(x.irc.state.getChannels())},onLocalMessage:function(x,z,y,A){},onProcessingMessage:function(x,y){},onProcessedMessage:function(x,B){if(B.type==="servermsg"&&B.code===402){if(window.console){console.warn("Got session deleted error.  Generating new viewKey and reactivating...")}var A=t(h());A.viewKey=b();if(window.history.replaceState){var z=document.location.pathname+"?"+toQueryString(A)+document.location.hash;window.history.replaceState(null,document.title,z);var y=$.extend({},x.options);y.viewKey=A.viewKey;y.channels=s();$("#chatmore").chatmore(y).chatmore("resize")}else{v.warnOnUnload=false;document.location.search="?"+toQueryString(A)}}},onSendingMessage:function(x,y){},onErrorSendingMessage:function(x,z,y){},onSentMessage:function(x,y){},onActivatingClient:function(x,y,z,A){if(y==="resuming"||y==="activated"){v.freezeSideBar=false}},onDeactivatingClient:function(x){if(x.enableAutoReactivate&&x.reactivateAttempts<x.options.reactivateAttempts){v.freezeSideBar=true}else{v.freezeSideBar=false}},getColorizeCSSClass:function(y,x,A){var z=j(y,x,A);return z!==undefined?"color"+z:""}};$.chatmore("layouts")["default"]=v})();